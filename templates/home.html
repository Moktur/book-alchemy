<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Schneider CPC Library</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='schneider_cpc.css') }}">
  <style>
    .flashes {
      list-style: none;
      padding: 0;
    }

    .flashes .success {
      background-color: #c8e6c9;
      color: #2e7d32;
      padding: 10px;
      border-radius: 4px;
    }

    .flashes .error {
      background-color: #ffcdd2;
      color: #c62828;
      padding: 10px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <ul class="flashes">
    {% for category, message in messages %}
    <li class="{{ category }}">{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  {% endwith %}

  <!-- CPC Style Window -->
  <div class="window">
    <div class="title-bar">Meine Digitale Bibliothek</div>
    <div class="content">

      <h2>Library</h2>

      <!-- Search -->
      <form method="GET" action="/">
        <input type="text" name="q" placeholder="Search books or authors" value="{{ search_query }}">
        <button type="submit">Search</button>
        <input type="hidden" name="sort" value="{{ sort_by }}">
      </form>

      <!-- Sorting -->
      <p>Sort by:
        <a href="/?sort=title{% if search_query %}&q={{ search_query }}{% endif %}">Title</a> |
        <a href="/?sort=author{% if search_query %}&q={{ search_query }}{% endif %}">Author</a>
      </p>

      <!-- Book List -->
      {% if books %}
      {% for book in books %}
      <div class="book-entry">
        <h3>{{ book.title }}</h3>
        {% if book.isbn %}
        <img src="https://covers.openlibrary.org/b/isbn/{{ book.isbn }}-M.jpg" alt="Book cover for {{ book.title }}">
        {% else %}
        <p>No cover available</p>
        {% endif %}
        <p>Author: {{ book.author.name }}</p>
        <form method="POST" action="/book/{{ book.id }}/delete" style="display:inline;">
          <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');">
            Delete Book
          </button>
        </form>
      </div>
      {% endfor %}
      {% else %}
      <p>No books match your search.</p>
      {% endif %}

    </div>
  </div>

  <!-- Navigation -->
  <nav>
    <a href="/">Home</a> |
    <a href="/add_book">Add Book</a> |
    <a href="/add_author">Add Author</a>
  </nav>
  <hr>
</body>

</html>