<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Schneider CPC Library</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='schneider_cpc.css') }}">
</head>
<body>
  <div class="window">
    <div class="title-bar">Meine Digitale Bibliothek</div>
    <div class="content">

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <ul class="flash-messages">
            {% for category, message in messages %}
              <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <h2>Library</h2>

      <form method="GET" action="/">
        <label for="search">Suche:</label>
        <input type="text" id="search" name="q" placeholder="Search books or authors" value="{{ search_query }}">
        <input type="hidden" name="sort" value="{{ sort_by }}">
        <input type="submit" value="Search">
      </form>

      <p>Sort by:
        <a href="/?sort=title{% if search_query %}&q={{ search_query }}{% endif %}">Title</a> |
        <a href="/?sort=author{% if search_query %}&q={{ search_query }}{% endif %}">Author</a>
      </p>

      {% if books %}
        {% for book in books %}
          <div class="book-entry">
            <h3>{{ book.title }}</h3>
            {% if book.isbn %}
              <img src="https://covers.openlibrary.org/b/isbn/{{ book.isbn }}-M.jpg" alt="Book cover for {{ book.title }}">
            {% else %}
              <p>No cover available</p>
            {% endif %}
            <p>Author: {{ book.author.name }}</p>
            <form method="POST" action="/book/{{ book.id }}/delete" style="display:inline;">
              <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');">
                Delete Book
              </button>
            </form>
          </div>
        {% endfor %}
      {% else %}
        <p>No books match your search.</p>
      {% endif %}

    </div>
  </div>

  <nav class="navigation">
    <a href="{{ url_for('home') }}">Home</a> |
    <a href="{{ url_for('add_book') }}">Add Book</a> |
    <a href="{{ url_for('add_author') }}">Add Author</a>
  </nav>
</body>
</html>
